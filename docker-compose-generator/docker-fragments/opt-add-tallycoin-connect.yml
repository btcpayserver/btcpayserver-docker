version: "3"
services:
  btcpayserver:
    environment:
      BTCPAY_EXTERNALSERVICES: "Tallycoin Connect:${BTCPAY_PROTOCOL:-https}://${BTCPAY_HOST}/tallycoin-connect/;"
    volumes:
      - "tallycoin_connect_datadir:/etc/tallycoin_connect_datadir"
  tallycoin_connect:
    image: "dennisreimann/tallycoin_connect:v1.0.0@sha256:266cb62da9c7f81f97b1068bf40ba7e967009e1ff70f706f5363dcb6297197e6"
    restart: unless-stopped
    expose:
      - "8123"
    volumes:
      - "tallycoin_connect_datadir:/tallycoin_connect"
      - "lnd_bitcoin_datadir:/tallycoin_connect/lnd:ro"
    environment:
      PUBLIC_URL: ${BTCPAY_PROTOCOL:-https}://${BTCPAY_HOST}/tallycoin-connect/
      TALLYCOIN_APIKEY: "${TALLYCOIN_APIKEY}"
      LND_MACAROON_PATH: /tallycoin_connect/lnd/admin.macaroon
      LND_TLSCERT_PATH: /tallycoin_connect/lnd/tls.cert
      PORT: 8123
    links:
      - lnd_bitcoin
volumes:
  tallycoin_connect_datadir:
required:
  - "bitcoin-lnd"
  - "opt-lnd-grpc"
